## 12.1 인증

완벽한 인증이란 존재하지 않으며, 비밀번호는 누군가가 추측하거나 엿들을 수 있다

하지만 인증을 통해 누구인지 판단하는데 도움이 된다


### 12.1.1 HTTP의 인증요구/응답 프레임워크

HTTP는 사용자 인증을 하는 데 사용하는 자체 인증요구/응답 프레임워크를 제공한다

웹 에플리케이션이 HTTP 요청 메시지를 받으면, 서버는 현재 사용자가 누구인지 알 수 있도록 개인 정보를 요구하는 ‘인증 요구'로 응답할 수 있다

사용자가 다시 요청을 보낼 때는 인증 정보를 첨부해야 하며, 맞지 않으면 다시 인증요구를 보내거나 에러를 내고, 맞으면 요청은 제대로 처리된다


### 12.1.2 인증 프로토콜과 헤더

HTTP는 필요에 따라 고쳐 쓸 수 있는 제어 헤더를 통해, 다른 인증 프로토콜에 맞추어 확장할 수 있는 프레임워크를 제공한다

HTTP에는 기본 인증과 다이제스트 인증이라는 공식적인 인증 프로토콜이 있다

네 가지 인증 단계는 다음과 같다
1. 요청: 첫번째 요청은 인증 정보가 없다
2. WWW-Authenticate: 서버는 사용자에게 이름과 비밀번호를 제공하라는 의미로 요청을 반려한다. WWW-Authenticate 헤더는 해당 내용을 설명한다
3. Autorization: 클라이언트가 요청을 다시 보내면서, 인증 알고리즘과 사용자 이름, 비밀번호를 기술한 Authorization헤더를 보낸다
4. Authentication-Info: 인증 정보가 정확하면 서버는 문서와 함께 응답한다


### 12.1.3 보안 영역

서버가 클라이언트로 인증 요구를 할 때 realm 지시자가 기술되어 있는 WWW-Authenticate 헤더를 보게 된다

웹 서버는 기밀 분서를 보안 영역(realm) 그룹으로 나누며, 저마다 다른 사용자 권한을 요구한다

realm은 해설 형식으로 되어 있어, 사용자 이름과 비밀번호를 가지고 있는 사용자가 권한의 범위를 이해하는데 도움이 되어야 한다

---

## 12.2 기본 인증

기본 인증은 가장 잘 알려진 HTTP 인증 규약으로 거의 모든 주요 클라이언트와 서버에 구현되어 있다

웹 서버는 클라이언트의 요청을 거부하고 유효한 사용자 이름과 비밀번호를 요구할 수 있다

서버는 401 상태코드와 함께, 클라이언트가 접근하려고 했떤 보안 영역을 WWW-Authenticate에 기술해서 응답하여 인증요구를 시작한다

클라이언트는 사용자 계정과 비밀번호를 입력한 뒤, 브라우저에서 Authorization 헤더 안에 암호화해서 서버로 다시 보낸다


### 12.2.1 기본 인증의 예

HTTP 기본 인증의 WWW-Authenticate 헤더와 Authorization 헤더는 아래에서 설명한다
- 인증요구 (서버 → 클라이언트): 보안 영역마다 다른 비밀번호가 있다. realm은 요청받은 문서 집합의 이름을 따음표로 감싼 것으로 어떤 비밀번호를 사용해야 하는지 알수 있따
- 응답 (클라이언트 → 서버): 사용자 이름과 비밀번호는 콜론으로 잇고, base-64로 인코딩하여 네트워크 트래픽에 노출되지 않도록 핟나


### 12.2.2 Base-64 사용자 이름/비밀번호 인코딩

HTTP 기본 인증은 이름과 비밀번호를 콜론으로 이어 붙이고, base-64 인코딩 메서드를 사용해 인코딩한다

base-64 인코딩은 8비트 바이트로 이루어져 있는 시퀀스를 6비트 덩어리의 시퀀스로 변환한다

6비트 조각은 대부분 문자와 숫자로 이루어진 특별한 64개의 문자중에 선택된다

Base-64 인코딩은 문자열을 받아서 전송할 수 있으며, 전송 가능한 문자인 알파벳으로 변환하기 위해 발명되었다

또한 전송 중 원본 문자열이 변질될 걱정 없이 원격에서 디코딩 할 수 있다

해당 인코딩은 국제 문자나 헤더에서 사용할 수 없는 문자를 포함한 상태로 보내야할 때 유용하다

또한 사용자 이름과 비밀번호 문자를 섞을 수 있기 때문에, 사용자 이름과 비밀번호가 노출되는 문제를 예방하는데 도움이 된다


### 12.2.3 프락시 인증

중개 프락시 서버를 통해 인증할 수도 있으며, 어떤 회사는 서버나 LAN이나 무선 네트워크에 접근하기 전에 프락시 서버를 거치게 하여 사용자를 인증한다

프락시 서버에서 접근 정책을 중앙 관리할 수 있기 때문에, 리소스 전체에 대한 통합적인 접근 제어를 하기 위해 프락시 서버를 사용하면 좋다

프락시 인증은 웹 서버의 인증과 헤더와 상태코드만 다르고 절차는 동일하다
- 401 → 407
- WWW-Authenticate → Proxy-Authenticate
- Authorization → Proxy-Authorization
- Authentication-Info → Proxy-Authentication-Info

---

## 12.3 기본 인증의 보안 결함

1. 기본 인증은 쉽게 디코딩할 수 있다
2. 보안 비밀번호를 제삼자가 도용하여 그대로 원서버에 보내면 서버에 접근할 수 있다
3. 만약 치명적이지 않은 서버가 뚫리면 생기면 해당 서비스는 문제가 적지만, 같은 아이디 비밀번호를 사용하는 사람들은 위험에 노출된다
4. 인증 헤더를 제외하고, 다른 부분을 수정해서 본래 의도롤 바꾼 형태가 되면, 기본 인증은 정상적인 동작을 보장하지 않는다
5. 가짜 서버의 위장에 취약하다